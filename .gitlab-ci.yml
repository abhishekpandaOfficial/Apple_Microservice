#Test-1
stages:
  - sync

sync:
  stage: sync
  script:
    - git clone https://github.com/abhishekpandaOfficial/Apple_Microservice.git github-repo
    - cd github-repo
    - git config user.email "Official.abhishekpanda@gmail.com"
    - git config user.name "abhishekpandaOfficial"
    - git fetch origin

    # Check if the branch exists
    - |
      if git show-ref --verify --quiet "refs/heads/$CI_COMMIT_REF_NAME"; then
        git checkout $CI_COMMIT_REF_NAME
      else
        git checkout -b $CI_COMMIT_REF_NAME
      fi

    # Ensure the target directory is not the current directory
    - if [ "$CI_COMMIT_REF_NAME" != "." ]; then find ../. -maxdepth 1 -mindepth 1 -not -name "github-repo" -exec cp -r {} ./ \;; fi

    - git add .
    - git commit -m "Sync changes from GitLab"
    - git push origin $CI_COMMIT_REF_NAME
